<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AURORA DASHBOARD</title>
    <link rel="stylesheet" href="dist/css/bar.css" />
    <link rel="icon" href="dist/img/aurora.png" type="image/png"> <!-- Menambahkan favicon -->


    <!-- Google Font: Source Sans Pro -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
    />
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css" />
    <!-- overlayScrollbars -->
    <link
      rel="stylesheet"
      href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Open+Sans:400,700"
    />
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/adminlte.min.css" />
    <link rel="stylesheet" href="dist/css/bar.css" />
    <link rel="stylesheet" href="dist/css/css.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />


    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>



    
  </head> 
  <body
    class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed"
  >
    <div class="wrapper bg-navy">
      <!-- Preloader -->
     

      <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-dark bg-navy">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
        <li class="nav-item d-none d-sm-inline-block">
            <img
                src="dist/img/logo.png"
                alt=""
                class="m-auto"
                style="
                    margin: auto;
                    background-color: beige;
                    max-height: 40px;
                    padding: 2px;
                    padding-left: 5px;
                    padding-right: 15px;
                    border-radius: 15px 0 50px 0;
                    font-size: 10px;
                "
            />
        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <p class="nav-link" data-toggle="dropdown" href="#" id="dateTimeLink">
                Day: <span id="day"></span>
                <i class="fa fa-calendar-alt"></i> Date: <span id="date"></span>
                <i class="fa fa-clock"></i> Time: <span id="time"></span>
            </p>
        </li>
        
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
        <!-- Navbar Search -->

        <li class="nav-item text-left"></li>

        <!-- Messages Dropdown Menu -->

        <!-- Notifications Dropdown Menu -->

        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#" id="changeTrackDropdown">
                <i class="fa fa-road"></i> Ganti Lintasan
            </a>
            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right bg-navy">
                <a href="#" class="dropdown-item" id="trackB">
                    <i class="fas fa-ship mr-2"></i> Lintasan B
                </a>
                <a href="#" class="dropdown-item d-none" id="trackA">
                    <i class="fas fa-ship mr-2"></i> Lintasan A
                </a>
            </div>
        </li>

        <li class="nav-item list-unstyled">
          <a onclick="showOverlay()"  class="btn-getstarted" style="background-color: rgb(31, 31, 145); color: white">Show Data</a>

           
        </li>

        <li class="nav-item">
            <a
                class="nav-link"
                data-widget="fullscreen"
                href="#"
                role="button"
                style="color: aqua"
            >
                <i class="fas fa-expand-arrows-alt"></i>
            </a>
        </li>
    </ul>
</nav>
<!-- /.navbar -->

<!-- Main Sidebar Container -->
<aside class="main-sidebar sidebar-dark-primary elevation-1 bg-navy no-border">
    <!-- Brand Logo -->
    <a href="index3.html" class="brand-link bg-navy" style="padding-left: 50px">
        <i class="fas fa-ship"></i>
        <span class="brand-text font-weight-bold"> KKI - 2024</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Sidebar user panel (optional) -->
        <div class="user-panel mt-3 pb-3 d-flex no-border">
            <ul class="nav nav-pills nav-sidebar flex-column no-border" data-widget="treeview" role="menu" data-accordion="false">
                <li class="nav-item menu-open">
                    <a href="#" class="nav-link active no-border" id="dashboardText" style="background-color: #001f3f; box-shadow: none">
                        <i class="nav-icon fas fa-tachometer-alt"></i>
                        <p>Dashboard Lintasan A</p>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
            <ul>
                <div class="col-30 m-2">
                    <div class="row">
                        <div class="row mb-3 d-flex no-border">
                            <ul class="nav nav-pills nav-sidebar flex-column no-border" data-widget="treeview" role="menu" data-accordion="false">
                                <li class="nav-item menu-open">
                                    <a href="#" class="nav-link active no-border" style="background-color: #001f3f; box-shadow: none; text-align: center;">
                                        <p><span class="text-bold" style="font-size: 30px; margin:0;">AULIA SAGARA<br /></span><span class="font-italic">"Autonomous Unmanned Logistical Intelligence Apparatus"</span></p>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="card" style="margin-right: 5px">
                            <div class="card-header" style="background-color: #00264e">
                                <p class="info card-title font-weight-bold" style="font-size: 14px">Team Identity</p>

                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse" style="color: aqua">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                </div>
                                <!-- /.card-tools -->
                            </div>
                            <!-- /.card-header -->
                            <div class="card-body p-0 bg-navy">
                                <div class="card card-widget widget-user shadow">
                                    <!-- Add the bg color to the header using any of the bg-* classes -->
                                    <div class="d-block widget-user-header bg-info">
                                        <h5 class="d-block">Team: AURORA SAGARA</h5>
                                        <h5 class="widget-user-desc">Ship: AULIA</h5>
                                    </div>
                                    <div class="widget-user-image">
                                        <img class="img-circle elevation-2 bg-white" src="dist/img/aurora.png" alt="User Avatar" />
                                    </div>
                                    <div class="card-footer" style="background-color: #00264e">
                                        <div class="row">
                                            <div class="col-sm-20">
                                                <div class="description-block">
                                                    <h5 class="description-header">
                                                        Sekolah Tinggi Meteorologi Klimatologi dan Geofisika
                                                    </h5>
                                                </div>
                                                <!-- /.description-block -->
                                            </div>
                                            <!-- /.col -->
                                        </div>
                                        <!-- /.row -->
                                    </div>
                                </div>
                            </div>
                            <!-- /.card-body -->
                        </div>
                    </div>
                </div>
            </ul>
        </nav>
        <!-- /.sidebar -->
    </div>
</aside>


      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
        <section class="content" style="background-color: #00264e">
          <div class="container-fluid">
            <!-- Info boxes -->
            <div class="row">
              <div class="col-sm-20">
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-4">
                      <div class="row">
                        <div class="col">
                          <div
                            class="info-box"
                            style="background-color: #001f3f"
                          >
                            <div class="info-box-content">
                              <span class="info-box-number">Position Log</span>
                              <span class="info-box-content" id="status-info">
                                  Start/Running/Finish
                              </span>

                              <span class="progress-description"> </span>
                            </div>
                            <!-- /.info-box-content -->
                          </div>
                          <!-- /.info-box -->
                        </div>
                        <div class="col">
                          <div
                            class="info-box"
                            style="background-color: #001f3f"
                          >
                            <div class="info-box-content">
                             <span class="info-box-number" id="floating-ball-info">Floating Ball: 0</span>

                              <div class="progress" style="height: 10px; background-color: rgb(4, 60, 133);">
                                <div class="progress-bar" id="progress-bar" style="width: 0%;"></div>
                              </div>
                               

                                <script>
                                  function fetchBallsData() {
                                    // Fetch the latest balls count from the PHP API
                                    fetch('connection/getballs-api.php') // Ganti dengan nama file PHP yang sesuai
                                      .then(response => response.json())
                                      .then(data => {
                                        let width = 0; // Nilai default untuk width
                                        let floatingBallValue = 0; // Nilai default untuk Floating Ball
                              
                                        if (data.balls !== undefined) {
                                          width = data.balls; // Ambil nilai lebar dari database (10 - 100)
                              
                                          // Pastikan nilai width minimal 10 agar bisa dihitung
                                          if (width < 10) {
                                            width = 0; // Set ke 0 jika kurang dari 10
                                            floatingBallValue = 0; // Set Floating Ball ke 0
                                          } else {
                                            // Set the width of the progress bar
                                            document.getElementById('progress-bar').style.width = width + '%';
                              
                                            // Hitung nilai Floating Ball dari nilai lebar
                                            floatingBallValue = (width / 10); // Konversi lebar ke nilai floating ball
                                          }
                                        }
                              
                                        // Update the floating ball info
                                        document.getElementById('floating-ball-info').innerText = 'Floating Ball: ' + floatingBallValue;
                              
                                        // Update status info berdasarkan nilai floating ball
                                        let statusText;
                                        if (floatingBallValue === 0) {
                                          statusText = "Start";
                                        } else if (floatingBallValue >= 1 && floatingBallValue < 10) {
                                          statusText = "Running";
                                        } else if (floatingBallValue === 10) {
                                          statusText = "Finish";
                                        }
                                        document.getElementById('status-info').innerText = statusText;
                                      })
                                      .catch(error => console.error('Error fetching balls data:', error));
                                  }
                              
                                  // Panggil fungsi fetchBallsData setiap 5 detik (5000 milidetik)
                                  setInterval(fetchBallsData, 1000);
                              
                                  // Panggilan awal saat halaman pertama kali dimuat
                                  fetchBallsData();
                                </script>
                              

                              </div>
                              <span class="progress-description"> </span>
                            </div>
                            <!-- /.info-box-content -->
                          <!-- /.info-box -->
                        </div>
                      </div>

                      <div class="col-20 mr-1">
                        <div class="info-box bg-navy">
                          <div class="info-box-content">
                            <div class="inner text-center">
                              <p style="font-size: 14px">
                                Speed Over Ground (SOG)
                              </p>
                              <div class="gauge-container">
                                <div class="gauge" id="gauge1"></div>
                                <div class="gauge" id="gauge2"></div>
                                
                              </div>
                            </div>
                          </div>
                          <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                      </div>
                      <div class="col-20 mr-1">
                        <div class="info-box bg-navy">
                          <div class="info-box-content">
                            <div class="inner text-center">
                              <p style="font-size: 14px">
                                Course Over Ground (COG)
                              </p>
                              <div class="gauge-container">
                                <div class="gauge" id="gauge3"></div>
                              </div>
                            </div>
                          </div>
                          <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                      </div>
                    </div>

                    <!-- /.col -->
                    <div class="col-md-3">
                      <div class="row">
                          <div class="card" style="margin-right: 5px">
                              <div class="card-header bg-navy">
                                  <p class="card-title font-weight-bold" style="font-size: 14px">
                                      Mission Surface Imaging
                                  </p>
                                  <div class="card-tools">
                                      <button type="button" class="btn btn-tool" onclick="takeScreenshot('video1')" style="color: aqua">
                                        <i class="fas fa-camera"></i>
                                      </button>
                                      <button
                                          type="button"
                                          class="btn btn-tool"
                                          data-card-widget="collapse"
                                          style="color: aqua"
                                      >
                                          <i class="fas fa-minus"></i>
                                      </button>
                                     
                                  </div>
                                  <!-- /.card-tools -->
                              </div>
                              <!-- /.card-header -->
                              <div class="card-body p-0 bg-navy">
                                <div id="surface-image-container" style="position: relative; text-align: center;">
                                    <!-- Elemen gambar surface -->
                                    <img id="surface-image" src="" alt="Loading image..." style="width: 100%; height: auto;">
                                    
                                    <!-- Geotag untuk Surface Image -->
                                   
                                </div>
                                <div style="z-index: 999; position: absolute; bottom: 1px; left: 1px; text-align: left; font-size: 10px; padding: 2px; background-color: rgba(0, 0, 0, 0.5); border-radius: 4px; color: white;">
                                    <p>
                                        Datetime: <span id="day2"> </span>, <span id="date2"></span>, <span id="time2"></span><br />
                                        Lat: <span id="latitude2"></span> | Lon: <span id="longitude2"></span><br />
                                        SOG: <span id="sogKnot2">0</span> knot | <span id="sogKmh2">0</span> km/h<br />
                                        COG: <span id="cogDegree2">0</span>째
                                    </p>
                                </div>
                               
                            </div>
                           
                            
                              <!-- /.card-body -->
                          </div>
                      </div>
                      <div class="row">
                          <div class="card">
                              <div class="card-header bg-navy">
                                  <p class="card-title card-warning font-weight-bold" style="font-size: 14px">
                                      Mission Underwater Imaging
                                  </p>
                                  <div class="card-tools">
                                    <button type="button" class="btn btn-tool" onclick="takeScreenshot('video2')" style="color: aqua">
                                      <i class="fas fa-camera"></i>
                                  </button>
                                      <button
                                          type="button"
                                          class="btn btn-tool"
                                          data-card-widget="collapse"
                                          style="color: aqua"
                                      >
                                          <i class="fas fa-minus"></i>
                                      </button>
                                     
                                  </div>
                                  <!-- /.card-tools -->
                              </div>
                              <!-- /.card-header -->
                              <div class="card-body p-0" style="background-color: #001f3f">
                                <div id="underwater-image-container" style="position: relative; text-align: center;">
                                    <!-- Konten gambar underwater -->
                                    <p>Loading image...</p>
                                    <!-- Geotag untuk Underwater Image -->
                                    
                                </div>
                                <div style="z-index: 999; position: absolute; bottom: 1px; left: 1px; text-align: left; font-size: 10px; padding: 2px; background-color: rgba(0, 0, 0, 0.5); border-radius: 4px; color: white;">
                                    <p>
                                        Datetime: <span id="day3"> </span>, <span id="date3"></span>, <span id="time3"></span><br />
                                        Lat: <span id="latitude3"></span> | Lon: <span id="longitude3"></span><br />
                                        SOG: <span id="sogKnot3">0</span> knot | <span id="sogKmh3">0</span> km/h<br />
                                        COG: <span id="cogDegree3">0</span>째
                                    </p>
                                </div>
                            </div>
                            
                              <!-- /.card-body -->
                          </div>
                      </div>
                  </div>
                  
                  <canvas id="canvas" style="display: none;"></canvas>
                  
                  
                    <div class="col-md-5">
                      <div class="col-md-30">
                        <!-- Box Comment -->
                        <div class="card card-widget card-navy">
                          <div class="card-header bg-navy">
                            <div class="user-block">
                              <img
                                class="img-circle bg-white"
                                src="dist/img/aurora.png"
                                alt="User Image"
                              />
                              <span class="username"
                                ><a href="#">Monitoring</a></span
                              >
                            
 
    


                            </div>
                            <!-- /.user-block -->
                            <div class="card-tools">
                              <button
                                type="button"
                                class="btn btn-tool"
                                data-card-widget="collapse"
                                style="color: aqua"
                              >
                                <i class="fas fa-minus"></i>
                              </button>
                            </div>
                            <!-- /.card-tools -->
                          </div>
                          <!-- /.card-header -->
                          <div class="card-body bg-navy" style="position: relative; width: 100%; padding-top: 56.25%;">
                              <iframe
                                  id="youtube-frame"
                                  class="img-fluid pad"
                                  src=""
                                  frameborder="0"
                                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                  allowfullscreen
                                  style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                              </iframe>
                          </div>
                          
                          
                          <script>
                            // Mengambil link dari file GET
                            fetch('connection/getlink-api.php')
                                .then(response => response.json())
                                .then(data => {
                                    if (data.link) {
                                        // Menyisipkan link ke dalam iframe
                                        document.getElementById('youtube-frame').src = data.link;
                                    } else {
                                        console.error('No link found');
                                    }
                                })
                                .catch(error => console.error('Error fetching link:', error));
                        </script>


                        
                        </div>
                        <div class="card card-widget card-navy">
                          <div class="card-header bg-navy">
                            <span class="description text-white text-md" style="margin-right: 10px;">Latitude: <span id="latitude"></span></span>
                            <span class="description text-white text-md" style="margin-left: 10px;">Longitude: <span id="longitude"></span></span>
                        
                            <div class="card-tools">
                              <button type="button" class="btn btn-tool" data-card-widget="collapse" style="color: aqua">
                                <i class="fas fa-minus"></i>
                              </button>
                            </div>
                          </div>
                        
                          <div class="card-body bg-navy" style="position: relative; width: 100%;">
                            <div id="map" style="height: 200px; width: 100%;"></div>
                            <button id="reset-btn" style="
                              position: absolute;
                              bottom: 10px;
                              right: 10px;
                              z-index: 1000;
                              background-color: #800000;
                              color: white;
                              border: none;
                              padding: 5px;
                              font-size: 13px;
                              border-radius: 5px;
                              cursor: pointer;
                              box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
                              transition: background-color 0.3s ease, transform 0.2s ease;
                            ">
                              Reset Tracking
                            </button>

                          </div>
                        </div>
                        
                        
                        <!-- /.card -->
                      </div>
                      
                      <!-- /.chart-responsive -->
                    </div>

                    <!-- /.col -->
                  </div>
                  <!-- /.row -->
                </div>
                <!-- ./card-body -->
                
      <!-- /.content-wrapper -->
      <div id="overlay">
        <div class="overlay-content">
            <button class="close-button" onclick="hideOverlay()">Close</button>
            <div class="button-container">
              <button onclick="downloadData('xlsx')">Download XLSX</button>
              <button onclick="downloadData('csv')">Download CSV</button>
            </div>
            <div class="table-container">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Latitude</th>
                            <th>Longitude</th>
                            <th>SOG (Knots)</th>
                            <th>SOG (KMH)</th>
                            <th>COG (Degrees)</th>
                            
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div id="errorMessage" class="error"></div>
        </div>
    </div>

      <!-- Main Footer -->
       
      <footer class="main-footer bg-navy">
        <strong
          >Copyright &copy; 2024
          <a href="https://www.instagram.com/aurora.stmkg" style="color: aqua">Aurora STMKG</a>.</strong
        >
        <a href="#" onclick="unlockAccess()">All rights reserved.</a>

        <div
          class="float-right d-none d-sm-inline-block"
          style="
            background-color: beige;
            color: #001f3f;
            padding: 0 5px 0 15px;
            border-radius: 0 5px 0 20px;
          "
        >
          <b>AULIA
        </div>
      </footer>
    </div>
    <!--
    <script>
      let mediaRecorder;
      let chunks = [];
      let stream;
      let isRecording = false;

      document
        .getElementById("recordButton")
        .addEventListener("click", async () => {
          // Check if the browser supports getDisplayMedia
          if (!navigator.mediaDevices.getDisplayMedia) {
            alert("Your browser does not support screen recording");
            return;
          }

          if (isRecording) {
            alert("A recording is already in progress.");
            return;
          }

          try {
            // Prompt the user to select a screen/window to share
            stream = await navigator.mediaDevices.getDisplayMedia({
              video: true,
            });

            // Create a new MediaRecorder instance and set the stream as its source
            mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.ondataavailable = function (event) {
              if (event.data.size > 0) {
                chunks.push(event.data);
              }
            };

            mediaRecorder.onstop = function () {
              // Combine the recorded chunks into a single Blob
              const blob = new Blob(chunks, { type: "video/webm" });
              const videoURL = URL.createObjectURL(blob);

              // Create a temporary anchor element to trigger the download
              const a = document.createElement("a");
              a.href = videoURL;
              a.download = "screen-recording.webm";
              document.body.appendChild(a);
              a.click();

              // Clean up
              setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(videoURL);
              }, 100);
            };

            // Start recording
            mediaRecorder.start();
            isRecording = true;

            // Show stop button and hide record button
            document.getElementById("recordButton").style.display = "none";
            document.getElementById("stopButton").style.display = "block";
          } catch (error) {
            console.error("Error accessing display media.", error);
          }
        });

      document.getElementById("stopButton").addEventListener("click", () => {
        if (!isRecording) {
          return;
        }

        mediaRecorder.stop();
        stream.getTracks().forEach((track) => track.stop());
        chunks = []; // Clear chunks array for the next recording

        // Hide stop button and show record button
        document.getElementById("recordButton").style.display = "block";
        document.getElementById("stopButton").style.display = "none";
        isRecording = false;
      });
    </script>
   -->
    <!-- REQUIRED SCRIPTS -->
    <!-- jQuery -->
    <script src="plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- overlayScrollbars -->
    <script src="plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <!-- AdminLTE App -->
    <script src="dist/js/adminlte.js"></script>

    <!-- PAGE PLUGINS -->
    <!-- jQuery Mapael -->
    <script src="plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
    <script src="plugins/raphael/raphael.min.js"></script>
    <script src="plugins/jquery-mapael/jquery.mapael.min.js"></script>
    <script src="plugins/jquery-mapael/maps/usa_states.min.js"></script>
    <!-- ChartJS -->
    <script src="plugins/chart.js/Chart.min.js"></script>

    <!-- AdminLTE for demo purposes -->
    <script src="dist/js/demo.js"></script>
    <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
    <script src="dist/js/pages/dashboard2.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <script src="https://cdn3.devexpress.com/jslib/17.1.6/js/dx.all.js"></script>
    <script src="dist/js/script-index.js"></script>


    
    <script>
        let lastSurfaceTimestamp = 0; // Variabel untuk menyimpan timestamp terakhir untuk surface
        let lastUnderwaterTimestamp = 0; // Variabel untuk menyimpan timestamp terakhir untuk underwater
    
        function fetchSurfaceImage() {
            // Ambil gambar terbaru dari surface_image.php
            fetch(`connection/surface_image.php?lastTimestamp=${lastSurfaceTimestamp}`)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('surface-image-container');
                    if (data.image) {
                        container.innerHTML = `<img src="${data.image}" alt="Latest Surface Image" style="width: 100%; height: auto;">`;
                        lastSurfaceTimestamp = data.timestamp; // Update timestamp terakhir
                    } else {
                        // Jika tidak ada gambar baru
                        console.log(data.error);
                    }
                })
                .catch(error => {
                    console.error('Error fetching surface image:', error);
                    document.getElementById('surface-image-container').innerHTML = '<p>Error loading surface image.</p>';
                });
        }
    
        function fetchUnderwaterImage() {
            // Ambil gambar terbaru dari underwater_image.php
            fetch(`connection/underwater_image.php?lastTimestamp=${lastUnderwaterTimestamp}`)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('underwater-image-container');
                    if (data.image) {
                        container.innerHTML = `<img src="${data.image}" alt="Latest Underwater Image" style="width: 100%; height: auto;">`;
                        lastUnderwaterTimestamp = data.timestamp; // Update timestamp terakhir
                    } else {
                        // Jika tidak ada gambar baru
                        console.log(data.error);
                    }
                })
                .catch(error => {
                    console.error('Error fetching underwater image:', error);
                    document.getElementById('underwater-image-container').innerHTML = '<p>Error loading underwater image.</p>';
                });
        }
    
        // Fetch gambar pertama kali saat halaman dimuat
        fetchSurfaceImage();
        fetchUnderwaterImage();
    
        // Fetch gambar setiap 1 detik
        setInterval(fetchSurfaceImage, 1000);
        setInterval(fetchUnderwaterImage, 1000);
    </script>
  
  
  

      
<!--<script>
  // Meminta akses ke kamera
  navigator.mediaDevices.getUserMedia({ video: true })
      .then(function(stream) {
          // Menyambungkan stream ke video pertama
          const video1 = document.getElementById('video1');
          video1.srcObject = stream;

          // Menyambungkan stream ke video kedua
          const video2 = document.getElementById('video2');
          video2.srcObject = stream;
      })
      .catch(function(error) {
          console.error("Error accessing the camera: ", error);
          alert("Could not access the camera. Please check your settings.");
      });
</script>
<script>
  // Meminta akses ke kamera
  navigator.mediaDevices.getUserMedia({ video: true })
      .then(function(stream) {
          const video1 = document.getElementById('video1');
          video1.srcObject = stream;
          const video2 = document.getElementById('video2');
          video2.srcObject = stream;
      })
      .catch(function(error) {
          console.error("Error accessing the camera: ", error);
          alert("Could not access the camera. Please check your settings.");
      });

  function takeScreenshot(videoId) {
      const video = document.getElementById(videoId);
      const canvas = document.getElementById('canvas');
      const context = canvas.getContext('2d');
      
      // Atur ukuran canvas sesuai dengan video
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      // Gambar frame video ke canvas
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      // Buat link untuk mengunduh gambar
      canvas.toBlob(function(blob) {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'screenshot_video.png';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url); // Hapus URL setelah klik
      });
  }

 

</script>-->

<script>
    function updateDateTime() {
        const now = new Date();
  
        // Mendapatkan nama hari
        const options = { weekday: 'long' };
        const day = now.toLocaleDateString('en-US', options);
  
        // Mendapatkan tanggal, bulan, tahun
        const date = now.toLocaleDateString('en-GB'); // DD/MM/YYYY
  
        // Mendapatkan jam, menit, detik
        const time = now.toLocaleTimeString('en-GB'); // hh:mm:ss
  
        // Mengupdate elemen di HTML untuk set 1
        document.getElementById('day').textContent = day;
        document.getElementById('date').textContent = date;
        document.getElementById('time').textContent = time;
  
        // Mengupdate elemen di HTML untuk set 2
        document.getElementById('day2').textContent = day;
        document.getElementById('date2').textContent = date;
        document.getElementById('time2').textContent = time;
  
        // Mengupdate elemen di HTML untuk set 3
        document.getElementById('day3').textContent = day;
        document.getElementById('date3').textContent = date;
        document.getElementById('time3').textContent = time;
    }
  
    // Memanggil fungsi untuk pertama kali
    updateDateTime();
  
    // Memperbarui waktu setiap detik
    setInterval(updateDateTime, 1000);
  </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<script>
    async function fetchData() {
        try {
            const response = await fetch('connection/get_gauges_data.php'); // Ganti dengan URL API Anda
            const data = await response.json();

            if (data.error) {
                document.getElementById('sogKnot').innerText = 'Error';
                document.getElementById('sogKmh').innerText = 'Error';
                document.getElementById('cogDegree').innerText = 'Error';
            } else {
                // Menampilkan data di dalam elemen <span>
                document.getElementById('sogKnot').innerText = data.sog_knot.toFixed(2);
                document.getElementById('sogKmh').innerText = data.sog_kmh.toFixed(2);
                document.getElementById('cogDegree').innerText = data.cog_degree.toFixed(2);
            }
        } catch (error) {
            document.getElementById('sogKnot').innerText = 'Error';
            document.getElementById('sogKmh').innerText = 'Error';
            document.getElementById('cogDegree').innerText = 'Error';
        }
    }

    // Memanggil fungsi fetchData setiap 1 detik
    setInterval(fetchData, 1000);
    // Panggil pertama kali untuk menampilkan data segera
    fetchData();
</script>
<script>
    async function fetchData() {
        try {
            const response = await fetch('connection/get_gauges_data.php'); // Ganti dengan URL API Anda
            const data = await response.json();

            if (data.error) {
                document.getElementById('sogKnot2').innerText = 'Error';
                document.getElementById('sogKmh2').innerText = 'Error';
                document.getElementById('cogDegree2').innerText = 'Error';
            } else {
                // Menampilkan data di dalam elemen <span>
                document.getElementById('sogKnot2').innerText = data.sog_knot.toFixed(2);
                document.getElementById('sogKmh2').innerText = data.sog_kmh.toFixed(2);
                document.getElementById('cogDegree2').innerText = data.cog_degree.toFixed(2);
            }
        } catch (error) {
            document.getElementById('sogKnot2').innerText = 'Error';
            document.getElementById('sogKmh2').innerText = 'Error';
            document.getElementById('cogDegree2').innerText = 'Error';
        }
    }

    // Memanggil fungsi fetchData setiap 1 detik
    setInterval(fetchData, 1000);
    // Panggil pertama kali untuk menampilkan data segera
    fetchData();
</script>
<script>
    async function fetchData() {
        try {
            const response = await fetch('connection/get_gauges_data.php'); // Ganti dengan URL API Anda
            const data = await response.json();

            if (data.error) {
                document.getElementById('sogKnot3').innerText = 'Error';
                document.getElementById('sogKmh3').innerText = 'Error';
                document.getElementById('cogDegree3').innerText = 'Error';
            } else {
                // Menampilkan data di dalam elemen <span>
                document.getElementById('sogKnot3').innerText = data.sog_knot.toFixed(2);
                document.getElementById('sogKmh3').innerText = data.sog_kmh.toFixed(2);
                document.getElementById('cogDegree3').innerText = data.cog_degree.toFixed(2);
            }
        } catch (error) {
            document.getElementById('sogKnot3').innerText = 'Error';
            document.getElementById('sogKmh3').innerText = 'Error';
            document.getElementById('cogDegree3').innerText = 'Error';
        }
    }

    // Memanggil fungsi fetchData setiap 1 detik
    setInterval(fetchData, 1000);
    // Panggil pertama kali untuk menampilkan data segera
    fetchData();
</script>
<script>
  $(function () {
      class GaugeChart {
          constructor(element, params) {
              this._element = element;
              this._initialValue = params.initialValue;
              this._higherValue = params.higherValue;
              this._title = params.title;
              this._subtitle = params.subtitle;
              this._startAngle = params.startAngle || 180;
              this._endAngle = params.endAngle || 360;
          }

          _buildConfig() {
              return {
                  value: this._initialValue,
                  valueIndicator: {
                      color: "#fff",
                  },
                  geometry: {
                      startAngle: this._startAngle,
                      endAngle: this._endAngle,
                  },
                  scale: {
                      startValue: 0,
                      endValue: this._higherValue,
                      customTicks: this._getCustomTicks(),
                      tick: {
                          length: 5,
                      },
                      label: {
                          font: {
                              color: "white",
                              size: 12,
                              family: '"Open Sans", sans-serif',
                          },
                      },
                  },
                  title: {
                      verticalAlignment: "bottom",
                      text: this._title,
                      font: {
                          family: '"Open Sans", sans-serif',
                          color: "#fff",
                          size: 0,
                      },
                      subtitle: {
                          text: this._subtitle,
                          font: {
                              family: '"Open Sans", sans-serif',
                              color: "#fff",
                              weight: 700,
                              size: 18,
                          },
                      },
                  },
                  onInitialized: function () {
                      let currentGauge = $(this._element);
                      currentGauge.find(".dxg-title text").first().attr("y", 48);
                      currentGauge.find(".dxg-title text").last().attr("y", 28);
                  }.bind(this),
              };
          }

          _getCustomTicks() {
              if (this._title.includes("Degree")) {
                  return [0, 45, 90, 135, 180, 225, 270, 315, 360];
              } else {
                  return [0, 5, 10, 15, 20, 25, 30];
              }
          }

          init() {
              $(this._element).dxCircularGauge(this._buildConfig());
          }

          updateValue(value) {
              const gaugeInstance = $(this._element).dxCircularGauge("instance");
              if (gaugeInstance) {
                  gaugeInstance.option("value", value);
              } else {
                  console.error("Gauge instance not found.");
              }
          }

          // Tambahkan metode untuk memperbarui subtitle secara langsung
          updateSubtitle(subtitleText) {
              const gaugeInstance = $(this._element).dxCircularGauge("instance");
              if (gaugeInstance) {
                  gaugeInstance.option("title.subtitle.text", subtitleText); // Perbarui subtitle dengan teks yang diberikan
              }
          }
      }

      $(document).ready(function () {
          // Inisialisasi Gauge
          let gauge1Params = {
              initialValue: 0,
              higherValue: 30,
              title: "Speed Over Ground (SOG) Knot",
              subtitle: "0 knot", // Menambahkan satuan di subtitle
          };

          let gauge1 = new GaugeChart("#gauge1", gauge1Params);
          gauge1.init();

          let gauge2Params = {
              initialValue: 0,
              higherValue: 30,
              title: "Speed Over Ground (SOG) km/h",
              subtitle: "0 km/h", // Menambahkan satuan di subtitle
          };

          let gauge2 = new GaugeChart("#gauge2", gauge2Params);
          gauge2.init();

          let gauge3Params = {
              initialValue: 0,
              higherValue: 360,
              title: "Course Over Ground (COG) Degree",
              subtitle: "0째", // Menambahkan satuan di subtitle
              startAngle: 0,
              endAngle: 360,
          };

          let gauge3 = new GaugeChart("#gauge3", gauge3Params);
          gauge3.init();

          // Fungsi untuk memperbarui gauge dari database
          function updateGaugesFromDatabase() {
              $.getJSON("connection/get_gauges_data.php", function (data) {
                  console.log(data); // Melihat data yang diterima dari PHP

                  if (data) {
                      if (data.sog_knot !== undefined) {
                          const sogKnotValue = parseFloat(data.sog_knot); // Mengambil nilai numerik
                          gauge1.updateValue(sogKnotValue);
                          gauge1.updateSubtitle(`${sogKnotValue} knot`); // Memperbarui subtitle dengan satuan
                      }
                      if (data.sog_kmh !== undefined) {
                          const sogKmhValue = parseFloat(data.sog_kmh); // Mengambil nilai numerik
                          gauge2.updateValue(sogKmhValue);
                          gauge2.updateSubtitle(`${sogKmhValue} km/h`); // Memperbarui subtitle dengan satuan
                      }
                      if (data.cog_degree !== undefined) {
                          const cogDegreeValue = parseFloat(data.cog_degree); // Mengambil nilai numerik
                          gauge3.updateValue(cogDegreeValue);
                          gauge3.updateSubtitle(`${cogDegreeValue}째`); // Memperbarui subtitle dengan satuan
                      }

                      // Menampilkan Latitude dan Longitude
                      if (data.lat !== undefined) {
                          $('#latitude').text(data.lat);
                      }
                      if (data.lon !== undefined) {
                          $('#longitude').text(data.lon);
                      }
                      // Menampilkan Latitude dan Longitude
                      if (data.lat !== undefined) {
                          $('#latitude2').text(data.lat);
                      }
                      if (data.lon !== undefined) {
                          $('#longitude2').text(data.lon);
                      }
                      // Menampilkan Latitude dan Longitude
                      if (data.lat !== undefined) {
                          $('#latitude3').text(data.lat);
                      }
                      if (data.lon !== undefined) {
                          $('#longitude3').text(data.lon);
                      }
                  } else {
                      console.error("No data found or invalid data.");
                  }
              }).fail(function () {
                  console.error("Failed to fetch data from the database.");
              });
          }

          // Panggil fungsi untuk memperbarui gauge
          updateGaugesFromDatabase();

          // Fetch data setiap 1 detik
          setInterval(updateGaugesFromDatabase, 1000);
      });
  });
</script>


<script>
  async function fetchGaugeData() {
      try {
          const response = await fetch('connection/get_gauges_data.php');
          const data = await response.json();

          if (data.error) {
              console.error(data.error);
          } else {
              document.getElementById('latitude').textContent = data.lat;
              document.getElementById('longitude').textContent = data.lon;
              document.getElementById('latitude2').textContent = data.lat;
              document.getElementById('longitude2').textContent = data.lon;
              document.getElementById('latitude3').textContent = data.lat;
              document.getElementById('longitude3').textContent = data.lon;
          }
      } catch (error) {
          console.error('Error fetching data:', error);
      }
  }

  // Panggil fungsi fetchGaugeData saat halaman dimuat
  window.onload = fetchGaugeData;
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const dashboardText = document.getElementById('dashboardText').querySelector('p');
    const changeTrackDropdown = document.getElementById('changeTrackDropdown');
    const trackB = document.getElementById('trackB');
    const trackA = document.getElementById('trackA');

    // Event Listener untuk Lintasan B
    trackB.addEventListener('click', function() {
        // Ubah teks Dashboard
        dashboardText.textContent = 'Dashboard Lintasan B';

        // Ubah dropdown menjadi Lintasan A
        trackB.classList.add('d-none');
        trackA.classList.remove('d-none');
    });

    // Event Listener untuk Lintasan A
    trackA.addEventListener('click', function() {
        // Ubah teks Dashboard
        dashboardText.textContent = 'Dashboard Lintasan A';

        // Ubah dropdown menjadi Lintasan B
        trackA.classList.add('d-none');
        trackB.classList.remove('d-none');
    });
});

</script>


<script>
    let map, marker, polyline;
    let latLngs = [];
    let initialLatLng; // Variabel untuk menyimpan posisi awal
  
    // Inisialisasi peta
    function initMap(lat, lon) {
        // Set peta dengan lat dan lon dari data awal
        map = L.map('map').setView([lat, lon], 20); 
  
        // Menggunakan OpenStreetMap sebagai layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
  
        // Menambahkan ikon kapal
        let shipIcon = L.icon({
            iconUrl: 'dist/img/aurora-marker.png', // Ganti dengan URL ikon kapal yang benar
            iconSize: [40, 40], // Ukuran ikon
            iconAnchor: [20, 20], // Titik tengah ikon untuk penempatan yang tepat
            popupAnchor: [0, -20] // Menyesuaikan posisi popup jika ada
        });
  
        // Membuat marker kapal menggunakan ikon kapal
        marker = L.marker([lat, lon], { icon: shipIcon }).addTo(map);
  
        // Polyline untuk melacak perjalanan kapal
        polyline = L.polyline(latLngs, { color: 'red' }).addTo(map);
    }
  
    // Fungsi untuk memperbarui posisi kapal di peta
    function updateMap(lat, lon) {
        const latLng = [lat, lon];
        latLngs.push(latLng);  // Tambahkan koordinat baru ke array latLngs
  
        marker.setLatLng(latLng); // Pindahkan marker ke posisi baru
        map.setView(latLng, 20);  // Fokus ke lokasi baru di peta dengan zoom level 20
        polyline.setLatLngs(latLngs);  // Update garis perjalanan kapal
    }
  
    // Fungsi untuk reset tracking
    function resetTracking() {
        latLngs = [];  // Mengosongkan array latLngs untuk menghapus jejak pelacakan
        polyline.setLatLngs(latLngs);  // Menghapus garis perjalanan dari peta
  
        // Mengatur ulang marker ke posisi awal
        if (initialLatLng) {
            marker.setLatLng(initialLatLng); // Kembalikan marker ke posisi awal
            map.setView(initialLatLng, 20); // Fokus ke posisi awal di peta dengan zoom level 20
        }
    }
  
    // Inisialisasi peta ketika dokumen siap
    $(document).ready(function () {
        // Inisialisasi peta dengan posisi default (0, 0)
        initMap(-7.332054, 112.756477); 
  
        // Fetch data latitude dan longitude dari server
        $.getJSON("connection/get_gauges_data.php", function (data) {
            if (data.lat !== undefined && data.lon !== undefined) {
                initialLatLng = [data.lat, data.lon]; // Menyimpan posisi awal
                updateMap(data.lat, data.lon); // Update peta dengan posisi awal
  
                // Update peta dengan data terbaru setiap detik
                setInterval(function () {
                    $.getJSON("connection/get_gauges_data.php", function (data) {
                        if (data.lat !== undefined && data.lon !== undefined) {
                            $('#latitude').text(data.lat);
                            $('#longitude').text(data.lon);
                            
                            updateMap(data.lat, data.lon);  // Update peta dengan lat dan lon terbaru
                        }
                    });
                }, 1000);  // Update setiap 1 detik
            } else {
                console.error("Data latitude dan longitude tidak tersedia.");
            }
        }).fail(function() {
            console.error("Error fetching data from server.");
        });
  
        // Event listener untuk tombol reset tracking
        $('#reset-btn').click(function () {
            resetTracking(); // Panggil fungsi resetTracking saat tombol diklik
        });
    });
</script>


<script>
  function showOverlay() {
      document.getElementById("overlay").style.display = "block";
      getAllData();
  }

  function hideOverlay() {
      document.getElementById("overlay").style.display = "none";
  }

  function getAllData() {
      $.ajax({
          url: 'connection/get_all_for_table.php',
          method: 'GET',
          dataType: 'json',
          success: function (response) {
              let html = '';
              response.forEach(item => {
                  html += `
                      <tr>
                          <td>${item.waktu}</td>
                          <td>${item.lat}</td>
                          <td>${item.lon}</td>
                          <td>${item.sog_knot}</td>
                          <td>${item.sog_kmh}</td>
                          <td>${item.cog_degree}</td>
                      </tr>
                  `;
              });
              $('#dataTable tbody').html(html);
          },
          error: function () {
              $('#errorMessage').text('Failed to load data.');
          }
      });
  }

  function downloadData(format) {
      let table = document.getElementById("dataTable");
      let wb = XLSX.utils.table_to_book(table, { sheet: "Sheet1" });
      let now = new Date();
      let fileName = `Aurora-${now.toISOString().slice(0, 19).replace(/:/g, '-')}.${format}`;
      if (format === 'xlsx') {
          XLSX.writeFile(wb, fileName);
      } else if (format === 'csv') {
          let csv = XLSX.utils.sheet_to_csv(wb.Sheets["Sheet1"]);
          let blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          let link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.setAttribute('download', fileName);
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
      }
  }
</script>


<script>
  let accessGranted = false; // Access status

  // Prevent Right-Click
  document.addEventListener('contextmenu', function (e) {
      if (!accessGranted) {
          e.preventDefault();
          alert('Access denied!');
      }
  });

  // Prevent Keyboard Shortcuts
  document.addEventListener('keydown', function (e) {
      if (!accessGranted) {
          // Block Ctrl+U and Ctrl+Shift+I
          if (e.ctrlKey && (e.key === 'u' || e.key === 'U' || e.shiftKey && e.key === 'I')) {
              e.preventDefault();
              alert('Access denied!');
          }
          // Block F12 (DevTools)
          if (e.key === 'F12') {
              e.preventDefault();
              alert('Access denied!');
          }
      }
  });

  // Function to unlock access with a secret code
  function unlockAccess() {
      const secretCode = prompt('Enter the secret code:');
      if (secretCode === 'stmkg2024') { // Replace with your own secret code
          accessGranted = true;
          alert('Access granted! You can now use right-click and shortcuts.');
      } else {
          alert('Incorrect secret code!');
      }
  }
</script>

  
  </body>

  <svg
    width="0"
    height="0"
    version="1.1"
    class="gradient-mask"
    xmlns="http://www.w3.org/2000/svg"
  >
    <defs>
      <linearGradient id="gradientGauge">
        <stop class="color-red" offset="0%" />
        <stop class="color-yellow" offset="17%" />
        <stop class="color-green" offset="40%" />
        <stop class="color-yellow" offset="87%" />
        <stop class="color-red" offset="100%" />
      </linearGradient>
    </defs>
  </svg>
</html>
